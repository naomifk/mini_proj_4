---
title: "Mini_Project_4"
output:
  html_document:
   code_folding: hide
---

```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(knitr)
library(RMySQL)
db <- dbConnect(MySQL(), 
                host = "scidb.smith.edu", 
                user = "mth292", 
                password = "RememberPi", 
                dbname = "imdb")
knitr::opts_chunk$set(connection = db, max.print = 20)
```

```{r, message=FALSE, warning=FALSE,fig.show="hold", out.width="50%"}
female.nudity <- db %>%
  dbGetQuery("SELECT k.keyword, mk.movie_id, t.title, t.kind_id, t.production_year, COUNT(movie_id) as COUNT
FROM keyword AS k
LEFT JOIN movie_keyword AS mk ON mk.keyword_id=k.id
LEFT JOIN title AS t ON t.id=mk.movie_id
WHERE kind_id='1' AND keyword = 'female-nudity' AND production_year IS NOT NULL
GROUP BY production_year
ORDER BY production_year;")

female.nudity.graph <- ggplot(female.nudity, aes(x=production_year, y=COUNT))+
  geom_line()

female.nudity.graph

male.nudity <- db %>%
  dbGetQuery("SELECT k.keyword, mk.movie_id, t.title, t.kind_id, t.production_year, COUNT(movie_id) as COUNT
FROM keyword AS k
LEFT JOIN movie_keyword AS mk ON mk.keyword_id=k.id
LEFT JOIN title AS t ON t.id=mk.movie_id
WHERE kind_id='1' AND keyword = 'male-nudity' AND production_year IS NOT NULL
GROUP BY production_year
ORDER BY production_year;")

male.nudity.graph <- ggplot(male.nudity, aes(x=production_year, y=COUNT))+
  geom_line()

male.nudity.graph
```

```{r, message=FALSE, warning=FALSE}
female.directed <- db %>%
  dbGetQuery("SELECT k.keyword, mk.movie_id, t.title, t.kind_id, t.production_year, COUNT(movie_id) as COUNT
FROM keyword AS k
LEFT JOIN movie_keyword AS mk ON mk.keyword_id=k.id
LEFT JOIN title AS t ON t.id=mk.movie_id
WHERE kind_id='1' AND keyword = 'title-directed-by-female' AND production_year IS NOT NULL
GROUP BY production_year
ORDER BY production_year;")

female.directed.graph <- ggplot(female.directed, aes(x=production_year, y=COUNT))+
  geom_line()

female.directed.graph
```

```{r, message=FALSE, warning=FALSE, fig.show="hold", out.width="50%"}
joined.nudity <- male.nudity %>%
  inner_join(female.nudity, by = "production_year")

joined.nudity <- joined.nudity %>% 
  filter(production_year <= 2016)

nudity.plot <- ggplot(joined.nudity, aes(production_year)) + 
  geom_line(aes(y = COUNT.x, color = "COUNT.x"))+
  geom_line(aes(y = COUNT.y, color = "COUNT.y"))+
  scale_color_manual(values=c("COUNT.x"="#588fe8", "COUNT.y"="#e27ac0"))+
  ggtitle("The Difference in Female Nudity vs Male Nudity on Screen")+
  theme_minimal()

nudity.plot

joined.nudity.directed <- joined.nudity %>% 
  inner_join(female.directed, by="production_year")

directed_v_nudity_plot <- ggplot(joined.nudity.directed, aes(production_year))+
  geom_line(aes(y = COUNT.y, color = "COUNT.y"))+
  geom_line(aes(y = COUNT, color = "COUNT"))+
  scale_color_manual(values=c("COUNT.y"="#cc0066", "COUNT"="#ff9933"))+
  ggtitle("The Difference Between Movies with Female Nudity and Movies Directed by Women")+
  theme_minimal()

directed_v_nudity_plot
```

